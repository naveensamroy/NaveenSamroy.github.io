<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üèè Red Blasters Score Counter üèè</title>
<style>
:root{--sky:#3333ff;--bg:#f8f8f8;--card:#fff;--btn:#ddd;--accent:#FF4C4C;}
html,body{height:100%;margin:0;padding:0;font-family:"Courier New",monospace;background:var(--bg);color:#000;display:flex;justify-content:center;align-items:flex-start;}
.wrap{width:100%;max-width:560px;padding:12px;}
h1{text-align:center;color:var(--accent);margin:6px 0 12px;font-size:26px;}
.score{display:flex;justify-content:center;align-items:center;font-size:52px;font-weight:bold;gap:10px;border:2px solid var(--sky);padding:16px;border-radius:10px;background:var(--card);margin-bottom:8px;cursor:pointer;}
.score span{cursor:pointer;}
.target-info{text-align:center;font-size:16px;color:var(--sky);margin-bottom:12px;}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:8px 0;}
button{background:var(--btn);color:#000;border:2px solid #000;padding:14px 8px;border-radius:10px;font-size:20px;font-weight:bold;cursor:pointer;height:60px;}
button:hover{background:#ccc;}
.history{margin-top:14px;background:var(--card);border:2px solid var(--sky);border-radius:8px;padding:10px;color:#000;max-height:360px;overflow:auto;}
.history h3{margin:0 0 8px;color:var(--sky);font-size:18px;}
.history-entry{padding:6px 0;border-bottom:1px solid rgba(0,0,0,0.1);font-size:15px;}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:2000;}
.modal{display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:2001;background:var(--card);border:2px solid var(--sky);padding:14px;border-radius:10px;width:92%;max-width:420px;color:#000;}
.modal h2{margin:6px 0 10px;font-size:18px;}
.modal .row{display:flex;gap:8px;margin-top:10px;justify-content:center;flex-wrap:wrap;}
.modal input[type="number"], .modal input[type="text"]{width:86%;padding:10px;font-size:16px;border-radius:6px;border:1px solid var(--sky);background:#f8f8f8;color:#000;}
.small-muted{font-size:13px;color:rgba(0,0,0,0.6);margin-top:6px;text-align:center;}
@media(max-width:420px){.score{font-size:40px;padding:12px;}button{font-size:18px;height:52px;padding:12px 6px;}}
</style>
</head>
<body>
<div class="wrap">
<h1>üèè Red Blasters Score Counter üèè</h1>

<div class="score" title="Click to edit">
  <span id="score" onclick="editScore()">0</span>
  <span>/</span>
  <span id="wickets" onclick="editWickets()">0</span>
</div>

<div id="targetDisplay" class="target-info">-</div>

<!-- Runs buttons -->
<div class="grid-3">
  <button onclick="addRun(0)">0</button>
  <button onclick="addRun(1)">1</button>
  <button onclick="addRun(2)">2</button>
</div>
<div class="grid-3">
  <button onclick="openManualRun()">3+</button>
  <button onclick="addRun(4)">4Ô∏è‚É£</button>
  <button onclick="addRun(6)">6Ô∏è‚É£</button>
</div>

<!-- Extras & Wickets -->
<div class="grid-3">
  <button onclick="openExtra('wide')">Wide ‚ûï</button>
  <button onclick="openExtra('noball')">No Ball ‚ö†Ô∏è</button>
  <button onclick="openWicketPopup()">Wicket ü¶Ü</button>
</div>

<!-- Controls -->
<div class="grid-3">
  <button onclick="openTarget()">Set Target</button>
  <button onclick="undoLast()">‚Ü©Ô∏è Undo</button>
  <button onclick="openResetModal()">Reset</button>
</div>

<div class="grid-3">
  <button onclick="openShare()">üîó Share</button>
  <button onclick="downloadScore()">üíæ Save</button>
  <button onclick="toggleBg()">üåô/‚òÄÔ∏è</button>
</div>

<div class="grid-3">
  <button onclick="openCoin()">Toss Coin ü™ô</button>
</div>

<script>
let score = 0, wickets = 0, targetScore = null, ballsLeft = null;
let currentOver = 0, currentBall = 0;
const events = [];

function updateDisplay() {
  document.getElementById('score').innerText = score;
  document.getElementById('wickets').innerText = wickets;
  const t = document.getElementById('targetDisplay');
  if(targetScore!==null && ballsLeft!==null){
    const need = Math.max(targetScore - score,0);
    t.textContent = `Target: ${targetScore} | ${need} Needed in ${ballsLeft} Balls`;
  } else t.textContent = '-';
}

function labelFor(showBall){ return showBall ? `${currentOver}.${currentBall+1}` : '-'; }

function pushEvent(text, showBall=true, countBall=true, runsDelta=0, wicketDelta=0, ballsLeftDelta=0){
  const label = labelFor(showBall);
  const entryText = `${label} ${text}`;
  const log = document.getElementById('history-log');
  const div = document.createElement('div'); div.className='history-entry'; div.textContent=entryText;
  log.insertBefore(div, log.firstChild);
  events.push({ text: entryText, showBall, countBall, runsDelta, wicketDelta, ballsLeftDelta });
  if(countBall){ currentBall++; if(currentBall>=6){currentBall=0; currentOver++;} }
}

// ----------------- Runs -----------------
function addRun(runs){
  if(typeof runs!=='number'||runs<0) return;
  score += runs; let bDelta=0;
  if(ballsLeft!==null && ballsLeft>0){ ballsLeft--; bDelta=-1; }
  const tag = (runs===4?'4Ô∏è‚É£ ':runs===6?'6Ô∏è‚É£ ':'');
  pushEvent(`${tag}+${runs} Run(s)`, true, true, runs, 0, bDelta);
  updateDisplay();
}

function openManualRun(){ showModal('manualModal'); }
function submitManualRun(){
  const v = parseInt(document.getElementById('manualRuns').value,10);
  if(!isNaN(v) && v>=3) addRun(v);
  closeAll();
}

// ----------------- Extras -----------------
let extraType = null;
function openExtra(type){
  extraType = type;
  document.getElementById('extraRuns').value='1';
  document.getElementById('extraTitle').innerText = type==='wide'?'Wide - add runs':'No Ball - add runs';
  showModal('extraModal');
}
function submitExtra(){
  const r = parseInt(document.getElementById('extraRuns').value,10)||1;
  score += r;
  const emojiText = extraType==='wide'?'Wide ‚ûï ':'No Ball ‚ö†Ô∏è ';
  pushEvent(`${emojiText}+${r} Run(s)`, true, false, r,0,0);
  updateDisplay(); closeAll();
}

// ----------------- Wickets -----------------
function openWicketPopup(){ showModal('wicketModal'); }
function applyWicketWithRuns(runs){
  if(typeof runs!=='number'||runs<0)return;
  if(runs>0) score+=runs;
  wickets++; let bDelta=0;
  if(ballsLeft!==null && ballsLeft>0){ ballsLeft--; bDelta=-1; }
  const text = runs>0 ? `+${runs} W` : 'W';
  pushEvent(text, true, true, runs, 1, bDelta);
  updateDisplay(); closeAll();
}

// ----------------- Target -----------------
function openTarget(){ showModal('targetModal'); }
function oversToBalls(s){
  if(!s) return NaN;
  const t = String(s).trim();
  if(t.indexOf('.')===-1){ const f=parseInt(t,10); return isNaN(f)?NaN:f*6; }
  const parts = t.split('.'); const fo=parseInt(parts[0]||'0',10); const ex=parseInt(parts[1]||'0',10);
  if(isNaN(fo)||isNaN(ex)||ex<0||ex>5) return NaN; return fo*6+ex;
}
function submitTarget(){
  const trs = parseInt(document.getElementById('targetRuns').value,10);
  const oversStr = document.getElementById('targetOvers').value;
  const balls = oversToBalls(oversStr);
  if(isNaN(trs)||isNaN(balls)){ alert('Invalid target or overs'); return; }
  targetScore = trs; ballsLeft = balls;
  pushEvent(`Target: ${targetScore} | ${Math.max(targetScore-score,0)} Needed in ${ballsLeft} Balls`, false,false,0,0,0);
  updateDisplay(); closeAll();
}

// ----------------- Edit -----------------
function editScore(){ const v = prompt('Enter current score:',score); if(v===null)return; const n=parseInt(v,10); if(!isNaN(n)&&n>=0){score=n; pushEvent(`Manual Update: Score ${score} / Wickets ${wickets}`,false,false,0,0,0); updateDisplay();} else alert('Invalid number'); }
function editWickets(){ const v = prompt('Enter current wickets:',wickets); if(v===null)return; const n=parseInt(v,10); if(!isNaN(n)&&n>=0){wickets=n; pushEvent(`Manual Update: Score ${score} / Wickets ${wickets}`,false,false,0,0,0); updateDisplay();} else alert('Invalid number'); }

// ----------------- Undo -----------------
function undoLast(){
  if(events.length===0) return;
  if(!confirm("Are you sure you want to undo last action?")) return;
  const ev = events.pop();
  const log = document.getElementById('history-log'); if(log.firstChild) log.removeChild(log.firstChild);
  if(ev.runsDelta) score -= ev.runsDelta;
  if(ev.wicketDelta) wickets -= ev.wicketDelta;
  if(ev.ballsLeftDelta) ballsLeft -= ev.ballsLeftDelta;
  if(ev.countBall){ currentBall--; if(currentBall<0){currentOver--; currentBall=5; if(currentOver<0){currentOver=0;currentBall=0;} } }
  updateDisplay();
}
</script>

<!-- Modals -->
<div id="manualModal" class="modal">
<h2>Enter runs (3+)</h2>
<input id="manualRuns" type="number" min="3" value="3"/>
<div class="row">
  <button onclick="submitManualRun()">Add</button>
  <button onclick="closeAll()">Cancel</button>
</div>
</div>

<div id="extraModal" class="modal">
<h2 id="extraTitle">Extra</h2>
<input id="extraRuns" type="number" min="1" value="1"/>
<div class="row">
  <button onclick="submitExtra()">OK</button>
  <button onclick="closeAll()">Cancel</button>
</div>
<div class="small-muted">Extra runs added; does <strong>not</strong> consume a ball</div>
</div>

<div id="wicketModal" class="modal">
<h2>Wicket ‚Äî Enter runs scored on the ball (if any)</h2>
<div class="row">
  <button onclick="applyWicketWithRuns(0)">0</button>
  <button onclick="applyWicketWithRuns(1)">1</button>
  <button onclick="applyWicketWithRuns(2)">2</button>
  <button onclick="applyWicketWithRuns(3)">3</button>
  <button onclick="applyWicketWithRuns(4)">4</button>
  <button onclick="applyWicketWithRuns(5)">5</button>
</div>
<div class="row" style="margin-top:10px;">
  <button onclick="closeAll()">Cancel</button>
</div>
<div class="small-muted">Select runs scored on the wicket ball</div>
</div>

<div class="history">
  <h3>üìú Match History</h3>
  <div id="history-log"></div>
</div>
</div>

<div id="overlay" class="overlay" onclick="closeAll()"></div>

<script>
// ----------------------------
// Wide & No Ball Popups with Wickets
// ----------------------------

// Wide popup with run and wicket options
function openWidePopup() {
    showModal('wideModal');
    document.getElementById('wideRuns').value = 1;
}
function submitWide(){
    const r = parseInt(document.getElementById('wideRuns').value,10) || 1;
    score += r;
    pushEvent(`Wide ‚ûï +${r} Run(s)`, false, false, r, 0, 0);
    updateDisplay();
    closeAll();
}
function addWideWicket(type){
    wickets++;
    pushEvent(`Wide ‚ûï Wicket (${type})`, false, false, 0, 1, 0);
    updateDisplay();
    closeAll();
}

// No Ball popup with run, 3+ and wicket options
function openNoBallPopup() {
    showModal('noBallModal');
    document.getElementById('noBallRuns').value = 1;
}
function submitNoBall(){
    const r = parseInt(document.getElementById('noBallRuns').value,10) || 1;
    score += r;
    pushEvent(`No Ball ‚ö†Ô∏è +${r} Run(s)`, false, false, r, 0, 0);
    updateDisplay();
    closeAll();
}
function addNoBallWicket(type, runs=3){
    score += runs;
    wickets++;
    pushEvent(`No Ball ‚ö†Ô∏è +${runs} Run(s) Wicket (${type})`, false, false, runs, 1, 0);
    updateDisplay();
    closeAll();
}

// ----------------------------
// Coin Toss
// ----------------------------
function tossCoin() {
    const result = Math.random() < 0.5 ? "Heads" : "Tails";
    alert("ü™ô Coin Toss Result: " + result);
}

// ----------------------------
// Modals for Wide & No Ball
// ----------------------------
</script>

<div id="wideModal" class="modal">
<h2>Wide ‚ûï</h2>
<input id="wideRuns" type="number" min="1" value="1"/>
<div class="row">
    <button onclick="submitWide()">Add Runs</button>
    <button onclick="addWideWicket('Run Out')">Run Out Wicket</button>
    <button onclick="addWideWicket('Stump Out')">Stump Out Wicket</button>
    <button onclick="closeAll()">Cancel</button>
</div>
</div>

<div id="noBallModal" class="modal">
<h2>No Ball ‚ö†Ô∏è</h2>
<input id="noBallRuns" type="number" min="1" value="1"/>
<div class="row">
    <button onclick="submitNoBall()">Add Runs</button>
    <button onclick="addNoBallWicket('Run Out',3)">3+ Run + Run Out</button>
    <button onclick="addNoBallWicket('Wicket',3)">3+ Run + Wicket</button>
    <button onclick="closeAll()">Cancel</button>
</div>
</div>

<script>
// ----------------------------
// Share & Save Functions
// ----------------------------
function openShare() {
    const data = `üèè Red Blasters Score\nScore: ${score}/${wickets}`;
    navigator.clipboard.writeText(data).then(() => {
        alert("Score copied to clipboard!");
    }).catch(() => {
        alert("Unable to copy. Please copy manually:\n" + data);
    });
}

function downloadScore() {
    const text = `üèè Red Blasters Score\nScore: ${score}/${wickets}`;
    const blob = new Blob([text], {type: 'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "RedBlastersScore.txt";
    a.click();
    URL.revokeObjectURL(a.href);
}

// ----------------------------
// Background Toggle (Light & Dark)
// ----------------------------
function toggleBg() {
    const b = document.body;
    if (b.style.backgroundColor==='rgb(248, 248, 248)') {
        // Switch to dark
        b.style.backgroundColor = '#000';
        b.style.color = '#87CEEB';
        document.querySelectorAll('button, .modal').forEach(e=>{
            e.style.color='#87CEEB'; e.style.background='#111'; e.style.border='2px solid #87CEEB';
        });
    } else {
        // Switch to light
        b.style.backgroundColor = '#f8f8f8';
        b.style.color = '#000';
        document.querySelectorAll('button, .modal').forEach(e=>{
            e.style.color='#000'; e.style.background='#eee'; e.style.border='2px solid #000';
        });
    }
}

// ----------------------------
// Mobile Adjustments
// ----------------------------
function adjustForMobile() {
    document.querySelectorAll('.modal').forEach(m=>{
        m.style.width = window.innerWidth < 420 ? '92%' : '420px';
    });
}

window.addEventListener('resize', adjustForMobile);
window.addEventListener('load', adjustForMobile);

// ----------------------------
// Initialize Buttons for Light Mode
// ----------------------------
document.querySelectorAll('button').forEach(btn=>{
    btn.style.borderRadius='10px';
    btn.style.padding='12px';
    btn.style.fontWeight='bold';
});
</script>
