<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üèè Red Blasters Score Counter üèè</title>
<style>
:root{
  --sky:#555; --bg:#f8f8f8; --card:#fff; --btn:#eee; --accent:#FF4C4C;
}
html,body{height:100%; margin:0;}
body{
  font-family:"Courier New", monospace; background:var(--bg); color:#000;
  display:flex; justify-content:center; padding:18px;
}
.wrap{width:100%; max-width:560px;}
h1{ text-align:center; color:var(--accent); margin:6px 0 12px; font-size:26px; white-space:nowrap;}
.score{
  display:flex; justify-content:center; align-items:center;
  font-size:52px; font-weight:bold; gap:10px;
  border:2px solid var(--sky); padding:16px; border-radius:10px; background:var(--card);
  margin-bottom:8px;
}
.score span{ cursor:pointer; }
.target-info{ text-align:center; font-size:16px; margin-bottom:12px; }
.grid-3{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin:8px 0; }
button{
  background:var(--btn); color:#000; border:2px solid #000;
  padding:14px 8px; border-radius:10px; font-size:20px; font-weight:bold; cursor:pointer; height:60px;
}
button:hover{ background:#ddd; }
.history{ margin-top:14px; background:var(--card); border:2px solid var(--sky);
  border-radius:8px; padding:10px; color:#000; max-height:360px; overflow:auto;}
.history h3{ margin:0 0 8px; font-size:18px; }
.history-entry{ padding:6px 0; border-bottom:1px solid rgba(0,0,0,0.1); font-size:15px; }
.overlay{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.4); z-index:2000; }
.modal{ display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:2001;
       background:var(--card); border:2px solid var(--sky); padding:14px; border-radius:10px; width:92%; max-width:420px; color:#000;}
.modal h2{ margin:6px 0 10px; font-size:18px; }
.modal .row{ display:flex; gap:8px; margin-top:10px; justify-content:center; flex-wrap:wrap; }
.modal input[type="number"], .modal input[type="text"]{ width:86%; padding:10px; font-size:16px; border-radius:6px; border:1px solid var(--sky); background:#f0f0f0; color:#000;}
.small-muted{ font-size:13px; color:#555; margin-top:6px; text-align:center; }
@media(max-width:420px){ .score{ font-size:40px; padding:12px; } button{ font-size:18px; height:52px; padding:12px 6px; } }
</style>
</head>
<body>
<div class="wrap">
<h1>üèè Red Blasters Score Counter üèè</h1>

<div class="score" title="Click score or wickets to edit">
  <span id="score" onclick="editScore()">0</span>
  <span>/</span>
  <span id="wickets" onclick="editWickets()">0</span>
</div>

<div id="targetDisplay" class="target-info">-</div>

<!-- Runs buttons -->
<div class="grid-3">
  <button onclick="addRun(0)">0</button>
  <button onclick="addRun(1)">1</button>
  <button onclick="addRun(2)">2</button>
</div>
<div class="grid-3">
  <button onclick="openManualRun()">3+</button>
  <button onclick="addRun(4)">4Ô∏è‚É£</button>
  <button onclick="addRun(6)">6Ô∏è‚É£</button>
</div>

<!-- Extras & Wickets -->
<div class="grid-3">
  <button onclick="openWide()">Wide ‚ûï</button>
  <button onclick="openNoBall()">No Ball ‚ö†Ô∏è</button>
  <button onclick="openWicketPopup()">Wicket ü¶Ü</button>
</div>

<!-- Controls -->
<div class="grid-3">
  <button onclick="openTarget()">Set Target</button>
  <button onclick="undoLastConfirm()">‚Ü©Ô∏è Undo</button>
  <button onclick="openResetConfirm()">Reset</button>
</div>
<div class="grid-3">
  <button onclick="openShare()">üîó Share</button>
  <button onclick="downloadScore()">üíæ Save</button>
  <button onclick="toggleLightBg()">üåô/‚òÄÔ∏è</button>
</div>
<div class="grid-3">
  <button onclick="openCoin()">Toss Coin ü™ô</button>
</div>

<div class="history">
  <h3>üìú Match History</h3>
  <div id="history-log"></div>
</div>
</div>
<div id="overlay" class="overlay" onclick="closeAll()"></div>
<!-- Modals -->
<div id="manualModal" class="modal">
<h2>Enter runs (3+)</h2>
<input id="manualRuns" type="number" min="3" value="3" />
<div class="row">
  <button onclick="submitManualRun()">Add</button>
  <button onclick="closeAll()">Cancel</button>
</div>
</div>

<div id="wicketModal" class="modal">
<h2>Wicket ‚Äî Enter runs scored on the ball (if any)</h2>
<div class="row">
  <button onclick="applyWicketWithRuns(0)">0</button>
  <button onclick="applyWicketWithRuns(1)">1</button>
  <button onclick="applyWicketWithRuns(2)">2</button>
  <button onclick="applyWicketWithRuns(3)">3</button>
  <button onclick="applyWicketWithRuns(4)">4</button>
</div>
<div class="row" style="margin-top:10px;">
  <button onclick="closeAll()">Cancel</button>
</div>
<div class="small-muted">Select runs scored on the wicket ball</div>
</div>

<div id="targetModal" class="modal">
<h2>Set Target</h2>
<input id="targetRuns" type="number" placeholder="Target runs" />
<input id="targetOvers" type="text" placeholder="Overs left (e.g. 4.3)" />
<div class="row">
  <button onclick="submitTarget()">Set</button>
  <button onclick="closeAll()">Cancel</button>
</div>
</div>

<script>
let score = 0, wickets = 0, targetScore = null, ballsLeft = null;
let currentOver = 0, currentBall = 0;
const events = [];

function updateDisplay(){
  document.getElementById('score').innerText = score;
  document.getElementById('wickets').innerText = wickets;
  const t = document.getElementById('targetDisplay');
  if(targetScore !== null && ballsLeft !== null){
    const need = Math.max(targetScore - score,0);
    t.textContent = `Target: ${targetScore} | ${need} Needed in ${ballsLeft} Balls`;
  } else t.textContent='-';
}

function labelFor(showBall){ return showBall?`${currentOver}.${currentBall+1}`:'-'; }

function pushEvent(text,showBall=true,countBall=true,runsDelta=0,wicketDelta=0,ballsLeftDelta=0){
  const label = labelFor(showBall);
  const entryText = `${label} ${text}`;
  const log = document.getElementById('history-log');
  const div = document.createElement('div'); div.className='history-entry'; div.textContent=entryText;
  log.insertBefore(div, log.firstChild);
  events.push({text:entryText, showBall, countBall, runsDelta, wicketDelta, ballsLeftDelta});
  if(countBall){ currentBall++; if(currentBall>=6){ currentBall=0; currentOver++; } }
}

function addRun(runs){
  if(typeof runs!=='number'||runs<0)return;
  score += runs; let bDelta=0;
  if(ballsLeft!==null && ballsLeft>0){ ballsLeft--; bDelta=-1; }
  const tag = (runs===4?'4Ô∏è‚É£ ':runs===6?'6Ô∏è‚É£ ':'');
  pushEvent(`${tag}+${runs} Run(s)`,true,true,runs,0,bDelta);
  updateDisplay();
}

function openManualRun(){ showModal('manualModal'); }
function submitManualRun(){
  const v=parseInt(document.getElementById('manualRuns').value,10);
  if(!isNaN(v)&&v>=3)addRun(v); closeAll();
}

function openWicketPopup(){ showModal('wicketModal'); }
function applyWicketWithRuns(runs){
  if(typeof runs!=='number'||runs<0)return;
  if(runs>0)score+=runs;
  wickets++; let bDelta=0;
  if(ballsLeft!==null && ballsLeft>0){ ballsLeft--; bDelta=-1; }
  const text=runs>0?`+${runs} W`:'W';
  pushEvent(text,true,true,runs,1,bDelta);
  updateDisplay(); closeAll();
}

function openTarget(){ showModal('targetModal'); }
function oversToBalls(s){
  if(!s)return NaN;
  const t=String(s).trim();
  if(t.indexOf('.')===-1){ const f=parseInt(t,10); return isNaN(f)?NaN:f*6; }
  const parts=t.split('.'); const fo=parseInt(parts[0]||'0',10); const ex=parseInt(parts[1]||'0',10);
  if(isNaN(fo)||isNaN(ex)||ex<0||ex>5)return NaN; return fo*6+ex;
}
function submitTarget(){
  const trs=parseInt(document.getElementById('targetRuns').value,10);
  const oversStr=document.getElementById('targetOvers').value;
  const balls=oversToBalls(oversStr);
  if(isNaN(trs)||isNaN(balls)){ alert('Invalid target or overs'); return; }
  targetScore=trs; ballsLeft=balls;
  pushEvent(`Target: ${targetScore} | ${Math.max(targetScore-score,0)} Needed in ${ballsLeft} Balls`,false,false,0,0,0);
  updateDisplay(); closeAll();
}
<!-- Wide & No Ball Popup -->
<div id="extraModal" class="modal">
  <h2 id="extraTitle">Extra</h2>
  <input id="extraRuns" type="number" min="1" value="1" />
  <div class="row">
    <button onclick="submitExtra()">Add Runs</button>
    <button onclick="closeAll()">Cancel</button>
  </div>
  <div class="row" style="margin-top:10px;">
    <button onclick="applyExtraWicket('Run Out')">Run Out Wicket</button>
    <button onclick="applyExtraWicket('Stump Out')">Stump Out Wicket</button>
  </div>
  <div class="small-muted">Extras do not consume a ball</div>
</div>

<script>
let extraType = null;

function openExtra(type){
  extraType = type;
  document.getElementById('extraRuns').value = 1;
  document.getElementById('extraTitle').innerText = type==='wide'?'Wide':'No Ball';
  showModal('extraModal');
}

function submitExtra(){
  const r = parseInt(document.getElementById('extraRuns').value,10) || 1;
  score += r;
  const emojiText = extraType==='wide'?'Wide ‚ûï ':'No Ball ‚ö†Ô∏è ';
  pushEvent(`${emojiText}+${r} Run(s)`, true, false, r, 0, 0);
  updateDisplay(); closeAll();
}

function applyExtraWicket(type){
  wickets++;
  pushEvent(`${extraType==='wide'?'Wide':'No Ball'} Wicket (${type})`, true, false, 0, 1, 0);
  updateDisplay(); closeAll();
}

// Undo with confirmation
function undoLast(){
  if(events.length===0) return;
  if(!confirm("Are you sure you want to undo last action?")) return;
  const ev = events.pop();
  const log = document.getElementById('history-log'); 
  if(log.firstChild) log.removeChild(log.firstChild);
  if(ev.runsDelta) score -= ev.runsDelta;
  if(ev.wicketDelta) wickets -= ev.wicketDelta;
  if(ev.ballsLeftDelta) ballsLeft -= ev.ballsLeftDelta;
  if(ev.countBall){
    currentBall--; 
    if(currentBall<0){ currentOver--; currentBall=5; if(currentOver<0){currentOver=0; currentBall=0;} }
  }
  updateDisplay();
}

// Coin toss
function openCoin(){
  const result = Math.random()<0.5?'Heads':'Tails';
  alert('ü™ô Coin Toss: '+result);
}
</script>
<!-- Share Modal -->
<div id="shareModal" class="modal">
  <h2>Share Score</h2>
  <input id="shareLink" type="text" readonly style="width:90%" />
  <div class="row">
    <button onclick="copyShare()">Copy</button>
    <button onclick="closeAll()">Close</button>
  </div>
  <div class="small-muted">Open copied link to restore score & history</div>
</div>

<script>
// ----------------------------
// Share & Save Functions
// ----------------------------
function openShare(){
  const params = new URLSearchParams();
  params.set('score', score);
  params.set('wickets', wickets);
  params.set('target', targetScore!==null?targetScore:'');
  params.set('ballsLeft', ballsLeft!==null?ballsLeft:'');
  params.set('currentOver', currentOver);
  params.set('currentBall', currentBall);
  const arr = [];
  document.querySelectorAll('.history-entry').forEach(e=>arr.push(e.textContent));
  params.set('history', encodeURIComponent(arr.join('|')));
  const url = window.location.origin + window.location.pathname + '?' + params.toString();
  document.getElementById('shareLink').value = url;
  showModal('shareModal');
}

async function copyShare(){
  const v = document.getElementById('shareLink').value;
  try{
    if(navigator.clipboard && navigator.clipboard.writeText){
      await navigator.clipboard.writeText(v);
    } else {
      const inp = document.getElementById('shareLink'); inp.select(); document.execCommand('copy');
    }
    alert('Link copied!');
  } catch(e){
    alert('Copy failed, please copy manually:\n'+v);
  }
}

function downloadScore(){
  let txt = `üèè Red Blasters Score\nScore: ${score}/${wickets}\nTarget: ${targetScore ?? '-'}\nBalls Left: ${ballsLeft ?? '-'}\nHistory:\n`;
  document.querySelectorAll('.history-entry').forEach(e=>txt+=e.textContent+'\n');
  const blob = new Blob([txt], {type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'RedBlastersScore.txt';
  a.click();
  URL.revokeObjectURL(a.href);
}

// ----------------------------
// Mobile & Light Mode
// ----------------------------
function adjustForMobile(){
  document.querySelectorAll('.modal').forEach(m=>{
    m.style.width = window.innerWidth<420?'92%':'420px';
  });
}

window.addEventListener('resize', adjustForMobile);
window.addEventListener('load', adjustForMobile);

function toggleBg(){
  const b = document.body;
  if(b.style.backgroundColor==='rgb(248, 248, 248)'){
    b.style.backgroundColor='#000'; b.style.color='var(--sky)';
    document.querySelectorAll('.modal').forEach(m=>m.style.color='var(--sky)');
    document.querySelectorAll('button').forEach(btn=>{
      btn.style.backgroundColor='#222'; btn.style.color='var(--sky)'; btn.style.border='2px solid var(--sky)';
    });
  } else {
    b.style.backgroundColor='#f8f8f8'; b.style.color='#000';
    document.querySelectorAll('.modal').forEach(m=>m.style.color='#000');
    document.querySelectorAll('button').forEach(btn=>{
      btn.style.backgroundColor='#eee'; btn.style.color='#000'; btn.style.border='2px solid #000';
    });
  }
}
</script>
