<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üèè Red Blasters Score Counter üèè</title>
<style>
:root{
  --sky:#87CEEB; --bg:#000; --card:#111; --btn:#222; --accent:#FF4C4C;
}
html,body{ height:100%; margin:0; }
body{
  margin:0; font-family: "Courier New", monospace; background:var(--bg); color:var(--sky);
  display:flex; justify-content:center; padding:18px;
}
.wrap{ width:100%; max-width:560px; }
h1{ text-align:center; color:var(--accent); margin:6px 0 12px; font-size:26px; }
.score{
  display:flex; justify-content:center; align-items:center;
  font-size:52px; font-weight:bold; gap:10px;
  border:2px solid var(--sky); padding:16px; border-radius:10px; background:transparent;
  margin-bottom:8px;
}
.score span { cursor:pointer; }
.target-info{ text-align:center; font-size:16px; color:var(--sky); margin-bottom:12px; }
.grid-3{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin:8px 0; }
button{
  background:var(--btn); color:var(--sky); border:2px solid var(--sky);
  padding:14px 8px; border-radius:10px; font-size:20px; font-weight:bold; cursor:pointer;
  height:60px;
}
button:hover{ background:#333; }
.history{
  margin-top:14px; background:var(--card); border:2px solid var(--sky);
  border-radius:8px; padding:10px; color:var(--sky); max-height:360px; overflow:auto;
}
.history h3{ margin:0 0 8px; color:var(--sky); font-size:18px; }
.history-entry{ padding:6px 0; border-bottom:1px solid rgba(135,206,235,0.08); font-size:15px; }
.overlay{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); z-index:2000; }
.modal{ display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:2001;
       background:var(--card); border:2px solid var(--sky); padding:14px; border-radius:10px; width:92%; max-width:420px; color:var(--sky); }
.modal h2{ margin:6px 0 10px; font-size:18px; }
.modal .row{ display:flex; gap:8px; margin-top:10px; justify-content:center; flex-wrap:wrap; }
.modal input[type="number"], .modal input[type="text"]{
  width:86%; padding:10px; font-size:16px; border-radius:6px; border:1px solid var(--sky); background:#121212; color:var(--sky);
}
.small-muted{ font-size:13px; color:rgba(135,206,235,0.8); margin-top:6px; text-align:center; }
@media (max-width:420px){
  .score{ font-size:40px; padding:12px; }
  button{ font-size:18px; height:52px; padding:12px 6px; }
}
</style>
</head>
<body>
<div class="wrap">
<h1>üèè Red Blasters Score Counter üèè</h1>

<div class="score" title="Click score or wickets to edit">
  <span id="score" onclick="editScore()">0</span>
  <span>/</span>
  <span id="wickets" onclick="editWickets()">0</span>
</div>

<div id="targetDisplay" class="target-info">-</div>

<!-- Runs (3 per row) -->
<div class="grid-3">
  <button onclick="addRun(0)">0</button>
  <button onclick="addRun(1)">1</button>
  <button onclick="addRun(2)">2</button>
</div>
<div class="grid-3">
  <button onclick="openManualRun()">3+</button>
  <button onclick="addRun(4)">4Ô∏è‚É£</button>
  <button onclick="addRun(6)">6Ô∏è‚É£</button>
</div>

<!-- Extras & Wicket -->
<div class="grid-3">
  <button onclick="openExtra('wide')">Wide ‚ûï</button>
  <button onclick="openExtra('noball')">No Ball ‚ö†Ô∏è</button>
  <button onclick="openWicketPopup()">Wicket ü¶Ü</button>
</div>

<!-- Controls -->
<div class="grid-3">
  <button onclick="openTarget()">Set Target</button>
  <button onclick="undoLast()">‚Ü©Ô∏è Undo</button>
  <button onclick="resetMatch()">Reset</button>
</div>
<div class="grid-3">
  <button onclick="openShare()">üîó Share</button>
  <button onclick="downloadScore()">üíæ Save</button>
  <button onclick="toggleBg()">üåô/‚òÄÔ∏è</button>
</div>

<div class="history">
  <h3>üìú Match History</h3>
  <div id="history-log"></div>
</div>
</div>

<div id="overlay" class="overlay" onclick="closeAll()"></div>

<!-- Manual 3+ run modal -->
<div id="manualModal" class="modal">
<h2>Enter runs (3+)</h2>
<input id="manualRuns" type="number" min="3" value="3" />
<div class="row">
  <button onclick="submitManualRun()">Add</button>
  <button onclick="closeAll()">Cancel</button>
</div>
</div>

<!-- Extra modal -->
<div id="extraModal" class="modal">
<h2 id="extraTitle">Extra</h2>
<input id="extraRuns" type="number" min="1" value="1" />
<div class="row">
  <button onclick="submitExtra()">OK</button>
  <button onclick="closeAll()">Cancel</button>
</div>
<div class="small-muted">Extra runs added; does <strong>not</strong> consume a ball</div>
</div>

<!-- Wicket modal -->
<div id="wicketModal" class="modal">
<h2>Wicket ‚Äî Enter runs scored on the ball (if any)</h2>
<div class="row">
  <button onclick="applyWicketWithRuns(0)">0</button>
  <button onclick="applyWicketWithRuns(1)">1</button>
  <button onclick="applyWicketWithRuns(2)">2</button>
  <button onclick="applyWicketWithRuns(3)">3</button>
  <button onclick="applyWicketWithRuns(4)">4</button>
  <button onclick="applyWicketWithRuns(5)">5</button>
</div>
<div class="row" style="margin-top:10px;">
  <button onclick="closeAll()">Cancel</button>
</div>
<div class="small-muted">Select runs scored on the wicket ball</div>
</div>

<!-- Target modal -->
<div id="targetModal" class="modal">
<h2>Set Target</h2>
<input id="targetRuns" type="number" placeholder="Target runs" />
<input id="targetOvers" type="text" placeholder="Overs left (e.g. 4.3)" />
<div class="row">
  <button onclick="submitTarget()">Set</button>
  <button onclick="closeAll()">Cancel</button>
</div>
</div>

<!-- Share modal -->
<div id="shareModal" class="modal">
<h2>Share Score</h2>
<input id="shareLink" type="text" readonly style="width:90%" />
<div class="row">
  <button onclick="copyShare()">Copy</button>
  <button onclick="closeAll()">Close</button>
</div>
<div class="small-muted">Open copied link to restore score & history</div>
</div>

<script>
let score = 0, wickets = 0, targetScore = null, ballsLeft = null;
let currentOver = 0, currentBall = 0;
const events = [];

function updateDisplay(){
  document.getElementById('score').innerText = score;
  document.getElementById('wickets').innerText = wickets;
  const t = document.getElementById('targetDisplay');
  if (targetScore !== null && ballsLeft !== null){
    const need = Math.max(targetScore - score, 0);
    t.textContent = `Target: ${targetScore} | ${need} Needed in ${ballsLeft} Balls`;
  } else t.textContent = '-';
}

function labelFor(showBall){ return showBall ? `${currentOver}.${currentBall+1}` : '-'; }

function pushEvent(text, showBall=true, countBall=true, runsDelta=0, wicketDelta=0, ballsLeftDelta=0){
  const label = labelFor(showBall);
  const entryText = `${label} ${text}`;
  const log = document.getElementById('history-log');
  const div = document.createElement('div'); div.className='history-entry'; div.textContent=entryText;
  log.insertBefore(div, log.firstChild);
  events.push({ text: entryText, showBall, countBall, runsDelta, wicketDelta, ballsLeftDelta });
  if (countBall){ currentBall++; if(currentBall>=6){currentBall=0; currentOver++;} }
}

function addRun(runs){
  if(typeof runs!=='number'||runs<0)return;
  score+=runs; let bDelta=0;
  if(ballsLeft!==null && ballsLeft>0){ ballsLeft--; bDelta=-1; }
  const tag = (runs===4?'4Ô∏è‚É£ ':runs===6?'6Ô∏è‚É£ ':'');
  pushEvent(`${tag}+${runs} Run(s)`, true, true, runs,0,bDelta);
  updateDisplay();
}

function openManualRun(){ showModal('manualModal'); }
function submitManualRun(){
  const v=parseInt(document.getElementById('manualRuns').value,10);
  if(!isNaN(v)&&v>=3)addRun(v); closeAll();
}

let extraType=null;
function openExtra(type){
  extraType=type; document.getElementById('extraRuns').value='1';
  document.getElementById('extraTitle').innerText=type==='wide'?'Wide - add runs':'No Ball - add runs';
  showModal('extraModal');
}
function submitExtra(){
  const r=parseInt(document.getElementById('extraRuns').value,10)||1;
  score+=r;
  const emojiText = extraType==='wide'?'Wide ‚ûï ':'No Ball ‚ö†Ô∏è ';
  pushEvent(`${emojiText}+${r} Run(s)`,true,false,r,0,0);
  updateDisplay(); closeAll();
}

function openWicketPopup(){ showModal('wicketModal'); }
function applyWicketWithRuns(runs){
  if(typeof runs!=='number'||runs<0)return;
  if(runs>0)score+=runs; wickets++; let bDelta=0;
  if(ballsLeft!==null && ballsLeft>0){ ballsLeft--; bDelta=-1; }
  const text=runs>0?`+${runs} W`:'W';
  pushEvent(text,true,true,runs,1,bDelta);
  updateDisplay(); closeAll();
}

function openTarget(){ showModal('targetModal'); }
function submitTarget(){
  const trs=parseInt(document.getElementById('targetRuns').value,10);
  const oversStr=document.getElementById('targetOvers').value;
  const balls=oversToBalls(oversStr);
  if(isNaN(trs)||isNaN(balls)){ alert('Invalid target or overs'); return; }
  targetScore=trs; ballsLeft=balls;
  pushEvent(`Target: ${targetScore} | ${Math.max(targetScore-score,0)} Needed in ${ballsLeft} Balls`,false,false,0,0,0);
  updateDisplay(); closeAll();
}
function oversToBalls(s){
  if(!s)return NaN;
  const t=String(s).trim();
  if(t.indexOf('.')===-1){ const f=parseInt(t,10); return isNaN(f)?NaN:f*6; }
  const parts=t.split('.'); const fo=parseInt(parts[0]||'0',10); const ex=parseInt(parts[1]||'0',10);
  if(isNaN(fo)||isNaN(ex)||ex<0||ex>5)return NaN; return fo*6+ex;
}

function editScore(){ const v=prompt('Enter current score:',score); if(v===null)return; const n=parseInt(v,10); if(!isNaN(n)&&n>=0){score=n; pushEvent(`Manual Update: Score ${score} / Wickets ${wickets}`,false,false,0,0,0); updateDisplay(); } else alert('Invalid number'); }
function editWickets(){ const v=prompt('Enter current wickets:',wickets); if(v===null)return; const n=parseInt(v,10); if(!isNaN(n)&&n>=0){wickets=n; pushEvent(`Manual Update: Score ${score} / Wickets ${wickets}`,false,false,0,0,0); updateDisplay(); } else alert('Invalid number'); }

function undoLast(){
  if(events.length===0)return; const ev=events.pop();
  const log=document.getElementById('history-log'); if(log.firstChild)log.removeChild(log.firstChild);
  if(ev.runsDelta)score-=ev.runsDelta; if(ev.wicketDelta)wickets-=ev.wicketDelta;
  if(ev.ballsLeftDelta)ballsLeft-=ev.ballsLeftDelta;
  if(ev.countBall){ currentBall--; if(currentBall<0){currentOver--; currentBall=5; if(currentOver<0){currentOver=0; currentBall=0;} } }
  updateDisplay();
}

function resetMatch(){ score=0; wickets=0; targetScore=null; ballsLeft=null; currentOver=0; currentBall=0; document.getElementById('history-log').innerHTML=''; events.length=0; updateDisplay(); }

function openShare(){
  const params=new URLSearchParams();
  params.set('score',score); params.set('wickets',wickets); params.set('target',targetScore!==null?targetScore:'');
  params.set('ballsLeft',ballsLeft!==null?ballsLeft:''); params.set('currentOver',currentOver); params.set('currentBall',currentBall);
  const arr=[]; document.querySelectorAll('.history-entry').forEach(e=>arr.push(e.textContent));
  params.set('history',encodeURIComponent(arr.join('|')));
  const url=window.location.origin+window.location.pathname+'?'+params.toString();
  document.getElementById('shareLink').value=url; showModal('shareModal');
}
async function copyShare(){ const v=document.getElementById('shareLink').value; try{ if(navigator.clipboard&&navigator.clipboard.writeText) await navigator.clipboard.writeText(v); else { const inp=document.getElementById('shareLink'); inp.select(); document.execCommand('copy'); } alert('Link copied'); } catch(e){ alert('Copy failed'); } }

function downloadScore(){
  let txt=`Score: ${score} / ${wickets}\nTarget: ${targetScore ?? '-'}\nBalls Left: ${ballsLeft ?? '-'}\nHistory:\n`;
  document.querySelectorAll('.history-entry').forEach(e=>txt+=e.textContent+'\n');
  const blob=new Blob([txt],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='match_score.txt'; a.click(); URL.revokeObjectURL(a.href);
}

function toggleBg(){
  const b=document.body;
  if(b.style.backgroundColor===''||b.style.backgroundColor==='rgb(0, 0, 0)'||b.style.backgroundColor==='#000000'){
    b.style.backgroundColor='#ffffff'; b.style.color='#000';
    document.querySelectorAll('.modal').forEach(m=>m.style.color='#000');
  } else { b.style.backgroundColor='#000'; b.style.color='var(--sky)'; document.querySelectorAll('.modal').forEach(m=>m.style.color='var(--sky'); }
}

function showModal(id){ document.getElementById('overlay').style.display='block'; document.getElementById(id).style.display='block'; }
function closeAll(){ document.getElementById('overlay').style.display='none'; document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); }

window.onload=function(){
  const p=new URLSearchParams(window.location.search);
  if(p.has('score'))score=parseInt(p.get('score')||'0',10)||0;
  if(p.has('wickets'))wickets=parseInt(p.get('wickets')||'0',10)||0;
  if(p.has('target')){const t=p.get('target'); if(t!=='')targetScore=parseInt(t,10);}
  if(p.has('ballsLeft')){const b=p.get('ballsLeft'); if(b!=='')ballsLeft=parseInt(b,10);}
  if(p.has('currentOver'))currentOver=parseInt(p.get('currentOver')||'0',10)||0;
  if(p.has('currentBall'))currentBall=parseInt(p.get('currentBall')||'0',10)||0;
  const hist=p.get('history');
  if(hist){ const arr=decodeURIComponent(hist).split('|'); const log=document.getElementById('history-log'); arr.forEach(t=>{ const d=document.createElement('div'); d.className='history-entry'; d.textContent=t; log.appendChild(d); }); }
  updateDisplay();
}
</script>
</body>
</html>
