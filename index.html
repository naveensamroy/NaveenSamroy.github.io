<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üèè Red Blasters Score Counter üèè</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: white;
      margin: 0;
      padding: 0;
    }
    .title {
      font-size: 26px;
      font-weight: bold;
      color: #FF0000;
      margin: 15px 0;
    }
    .scoreboard {
      font-size: 42px;
      font-weight: bold;
      color: skyblue;
      margin: 10px 0;
    }
    .target-info {
      font-size: 18px;
      color: skyblue;
      font-weight: bold;
      margin-top: 5px;
    }
    .button-row {
      display: flex;
      justify-content: center;
      margin: 6px 0;
    }
    button {
      flex: 1 1 30%;
      margin: 4px;
      padding: 12px;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: lightcoral;
      color: white;
    }
    button:hover { opacity: 0.85; }
    .history {
      margin-top: 15px;
      font-size: 16px;
      text-align: left;
      max-width: 340px;
      margin-left: auto;
      margin-right: auto;
      color: black;
      background: #f5f5f5;
      padding: 8px;
      border-radius: 5px;
    }
    .popup {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 2px solid #000;
      padding: 15px;
      z-index: 10;
    }
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 5;
    }
  </style>
</head>
<body>
  <h1 class="title">üèè Red Blasters Score Counter üèè</h1>

  <div class="scoreboard">
    Score: <span id="score">0</span>/<span id="wickets">0</span>
  </div>
  <div id="targetDisplay" class="target-info">-</div>

  <!-- Buttons in 3 per row -->
  <div class="button-row">
    <button onclick="addRun(0)">0</button>
    <button onclick="addRun(1)">1</button>
    <button onclick="addRun(2)">2</button>
  </div>
  <div class="button-row">
    <button onclick="openRunPopup()">3+</button>
    <button onclick="addRun(4)">4Ô∏è‚É£</button>
    <button onclick="addRun(6)">6Ô∏è‚É£</button>
  </div>
  <div class="button-row">
    <button onclick="openPopup('wide')">Wide ‚ûï</button>
    <button onclick="openPopup('noball')">No Ball ‚ö†Ô∏è</button>
    <button onclick="openPopup('wicket')">Wicket ü¶Ü</button>
  </div>
  <div class="button-row">
    <button onclick="openTargetOversPrompt()">Set Target</button>
    <button onclick="resetMatch()">Reset</button>
    <button onclick="undoLast()">‚Ü©Ô∏è Undo</button>
  </div>
  <div class="button-row">
    <button onclick="openSharePopup()">üîó</button>
    <button onclick="downloadScore()">üíæ</button>
    <button onclick="toggleBackgroundEmoji()">üåô/‚òÄÔ∏è</button>
  </div>

  <div class="history" id="history"></div>

  <!-- Overlay + Popups -->
  <div class="overlay" id="overlay"></div>

  <div class="popup" id="runPopup">
    <p>Enter Runs:</p>
    <input type="number" id="manualRuns" min="3" value="3">
    <button onclick="submitManualRuns()">Add</button>
    <button onclick="closePopup()">Cancel</button>
  </div>

  <div class="popup" id="sharePopup">
    <p>Share Score</p>
    <input type="text" id="shareLink" readonly style="width:90%">
    <button onclick="copyLink()">Copy</button>
    <button onclick="closePopup()">Close</button>
  </div>

<script>
let score = 0, wickets = 0, balls = 0;
let targetScore = null, ballsLeft = null;
let historyLog = [];

function addRun(runs){
  score += runs;
  balls++;
  historyLog.push(overText()+" "+runs);
  updateDisplay();
}

function openRunPopup(){
  document.getElementById("overlay").style.display="block";
  document.getElementById("runPopup").style.display="block";
}
function submitManualRuns(){
  let runs = parseInt(document.getElementById("manualRuns").value);
  if(!isNaN(runs)){ addRun(runs); }
  closePopup();
}
function openPopup(type){
  if(type==='wide'){ score++; historyLog.push(overText()+" Wide"); }
  else if(type==='noball'){ score++; historyLog.push(overText()+" NoBall"); }
  else if(type==='wicket'){ wickets++; balls++; historyLog.push(overText()+" W"); }
  updateDisplay();
}
function openTargetOversPrompt(){
  let t = prompt("Enter Target Score:");
  let o = prompt("Enter Total Overs:");
  if(t && o){
    targetScore = parseInt(t);
    ballsLeft = parseInt(o)*6;
    updateDisplay();
  }
}
function updateDisplay(){
  document.getElementById("score").innerText = score;
  document.getElementById("wickets").innerText = wickets;
  let targetEl=document.getElementById("targetDisplay");
  if(targetScore!==null && ballsLeft!==null){
    let runsNeeded = Math.max(targetScore-score,0);
    targetEl.innerText = `Target: ${targetScore} | ${runsNeeded} Needed in ${ballsLeft} Balls`;
  } else targetEl.innerText = "-";
  renderHistory();
}
function renderHistory(){
  let hist = document.getElementById("history");
  hist.innerHTML = historyLog.map((h,i)=> (i+1)+". "+h).join("<br>");
}
function overText(){
  let over = Math.floor(balls/6);
  let ball = (balls%6)+1;
  return over+"."+ball;
}
function resetMatch(){
  score=0;wickets=0;balls=0;targetScore=null;ballsLeft=null;historyLog=[];
  updateDisplay();
}
function undoLast(){
  if(historyLog.length>0){
    let last = historyLog.pop();
    if(last.includes("W")){ wickets--; balls--; }
    else if(last.includes("Wide") || last.includes("NoBall")){ score--; }
    else{
      let run=parseInt(last.split(" ")[1]);
      score-=run; balls--;
    }
    updateDisplay();
  }
}
function openSharePopup(){
  let link = window.location.href.split("?")[0]+"?score="+score+"&w="+wickets;
  document.getElementById("shareLink").value=link;
  document.getElementById("overlay").style.display="block";
  document.getElementById("sharePopup").style.display="block";
}
function copyLink(){
  let copyText=document.getElementById("shareLink");
  copyText.select();
  document.execCommand("copy");
  alert("Link copied!");
}
function closePopup(){
  document.querySelectorAll(".popup").forEach(p=>p.style.display="none");
  document.getElementById("overlay").style.display="none";
}
function downloadScore(){
  let content="Score: "+score+"/"+wickets+"\nHistory:\n"+historyLog.join("\n");
  let blob=new Blob([content],{type:"text/plain"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="score.txt";
  a.click();
}
function toggleBackgroundEmoji(){
  document.body.style.backgroundColor = 
    (document.body.style.backgroundColor==="white"?"black":"white");
  document.body.style.color=(document.body.style.backgroundColor==="black"?"white":"black");
}
updateDisplay();
</script>
</body>
</html>
